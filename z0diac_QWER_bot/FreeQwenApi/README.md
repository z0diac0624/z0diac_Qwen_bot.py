# API-прокси для Qwen AI

Локальный API-прокси сервер для работы с Qwen AI через браузерную эмуляцию.

## Назначение

Этот проект позволяет:

- Использовать модели Qwen AI через локальный API
- Сохранять контекст диалогов между запросами
- Управлять диалогами через API
- Выбирать различные модели Qwen для генерации ответов

## Установка

1. Клонировать репозиторий
2. Установить зависимости:

```
npm install
```

3. Запустить сервер:

```
npm start
```

При первом запуске откроется окно браузера, в котором нужно авторизоваться на сайте Qwen AI. После успешной авторизации нажмите Enter в консоли для продолжения.

## Использование API

### Отправка сообщений

```
POST http://localhost:3264/api/chat
```

Тело запроса:

```json
{
  "message": "Текст сообщения",
  "model": "qwen-max-latest", // опционально, по умолчанию qwen-max-latest
  "chatId": "идентификатор_чата" // опционально
}
```

Если `chatId` не указан, будет создан новый диалог. Возвращенный `chatId` можно использовать в последующих запросах для продолжения диалога.

### Получение списка моделей

```
GET http://localhost:3264/api/models
```

### Проверка статуса авторизации

```
GET http://localhost:3264/api/status
```

## Управление диалогами

### Создание нового диалога

```
POST http://localhost:3264/api/chats
```

Возвращает:

```json
{
  "chatId": "уникальный_идентификатор"
}
```

### Получение списка всех диалогов

```
GET http://localhost:3264/api/chats
```

### Получение истории диалога

```
GET http://localhost:3264/api/chats/:chatId
```

### Удаление диалога

```
DELETE http://localhost:3264/api/chats/:chatId
```

### Переименование диалога

```
PUT http://localhost:3264/api/chats/:chatId/rename
```

Тело запроса:

```json
{
  "name": "Новое название чата"
}
```

### Автоматическое удаление диалогов

```
POST http://localhost:3264/api/chats/cleanup
```

Тело запроса (все параметры опциональны):

```json
{
  "olderThan": 604800000, // Удалить чаты старше указанного времени (в мс), например 7 дней
  "userMessageCountLessThan": 3, // Удалить чаты с менее чем 3 сообщениями от пользователя
  "messageCountLessThan": 5, // Удалить чаты с менее чем 5 сообщениями всего
  "maxChats": 50 // Оставить только 50 самых новых чатов
}
```

## Работа с контекстом

Система автоматически сохраняет историю диалога и отправляет ее в каждом запросе к API Qwen. Это позволяет моделям учитывать предыдущие сообщения при генерации ответов.

Для использования контекста в запросах:

1. Отправьте первое сообщение без указания `chatId`
2. Сохраните полученный `chatId` из ответа
3. Используйте этот `chatId` в последующих запросах

Пример последовательности запросов:

1. Первый запрос:

```json
{
  "message": "Привет, как тебя зовут?"
}
```

2. Ответ (сокращенно):

```json
{
  "chatId": "abcd-1234-5678",
  "choices": [...]
}
```

3. Второй запрос (с контекстом):

```json
{
  "message": "Сколько будет 2+2?",
  "chatId": "abcd-1234-5678"
}
```
